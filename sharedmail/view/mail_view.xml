<?xml version="1.0" encoding="UTF-8"?>
<openerp>
<data>

        <record model="ir.ui.view" id="view_message_form_sharedmail">
            <field name="name">mail.message.form.sharedmail</field>
            <field name="model">mail.message</field>
            <field name="inherit_id" ref="mail.view_message_form"/>
            <field name="arch" type="xml">
                <field name="body" position="before">
                    <group string="Info E-mail" col="4" attrs="{'invisible':[('server_sharedmail_id','=',False)]}" nolabel="1">
                        <field name="server_sharedmail_id"/>
                        <field name="out_server_sharedmail_id"/>
                        <field name="direction_sharedmail"/>
                    </group>
                </field>
                <field name="email_from" position="after">
                    <field name="sharedmail_to" attrs="{'invisible':[('server_sharedmail_id','=',False)]}"/>
                    <field name="sharedmail_cc" attrs="{'invisible':[('server_sharedmail_id','=',False)]}"/>
                </field>
            </field>
        </record>

        <!--<record model='ir.ui.view' id='message_pec_partner_tree'>-->
            <!--<field name="name">res.partner.pec.tree</field>-->
            <!--<field name="model">res.partner</field>-->
            <!--<field name="arch" type="xml">-->
                <!--<tree string="Pec">-->
                    <!--<field name="name" />-->
                    <!--<field name="phone" />-->
                    <!--<field name="pec_mail" />-->
                <!--</tree>-->
            <!--</field>-->
        <!--</record>-->

        <record model='ir.ui.view' id='message_sharedmail_form'>
            <field name="name">message.sharedmail.form</field>
            <field name="model">mail.message</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <form string="Pec" create="false" edit="false" delete="false">
                    <header>
                        <button name="%(sharedmail.action_reply_sharedmail_compose_message_wizard)d"
                                string="Rispondi" type="action" icon="terp-mail-message-new"
                                context="{'default_partner_ids':author_id and [author_id] or [],'default_composition_mode':'reply','pec_messages': True}"
                                groups="base.group_sharedmail_writer"/>
                        <field name="direction_sharedmail" invisible="1"/>
                    </header>
                    <sheet>
                        <div class="message_header">
                            <group col="4">
                                <field name="server_sharedmail_user" attrs="{'invisible':[('direction_sharedmail','!=','in')]}"/>
                                <field name="date" readonly="1"/>
                                <field name="author_id" string="Contatto Rubrica"/>
                                <newline/>
                                <field name="email_from" readonly="1" />
                                <newline/>
                                <field name="sharedmail_to" colspan="4" readonly="1" />
                                <field name="sharedmail_cc" colspan="4" readonly="1" />
                            </group>
                        </div>
                        <group class="message_data">
                            <field name="server_sharedmail_state" attrs="{'invisible':[('direction_sharedmail','=','in')]}"/>
                            <newline/>
                            <field name="subject" colspan="4" readonly="1" />
                            <group class="body-message-container">
                                <field name="body" colspan="4" readonly="1" string="Corpo del messaggio"/>
                            </group>
                        </group>
                        <notebook colspan="6" >
                            <page string="Attachment">
                                <field name="attachment_ids" nolabel="1" readonly="1"/>
                            </page>
                            <!--
                            <page string="Recipients" attrs="{'invisible':[('direction_sharedmail','!=','out')]}">
                                <field name="partner_ids"
                                            context = " {
                                                  'tree_view_ref' : 'sharedmail.message_sharedmail_partner_tree',
                                                  'sharedmail_messages': True}"
                                            nolabel="1" readonly="1"
                                />
                            </page>
                            -->
                            <page string="Risposte" groups="base.group_sharedmail_writer">
                                <field name="child_ids" nolabel="1"
                                 readonly="1"
                                 context = " {
                                                  'form_view_ref' : 'sharedmail.message_sharedmail_form',
                                                  'tree_view_ref' : 'sharedmail.message_sharedmail_tree',
                                                  'sharedmail_messages': True}">
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record model='ir.ui.view' id='message_sharedmail_tree'>
            <field name="name">message.sharedmail.tree</field>
            <field name="model">mail.message</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <tree string="E-mail" create="false" delete="false">
                    <field name="direction_sharedmail" invisible="1"/>
                    <field name="email_from" string="Mittente"/>
                    <field name="date" />
                    <field name="subject" />
                    <!--<field name="sharedmail_server_user" string="Account"/>-->
                    <field name="server_sharedmail_user" attrs="{'invisible':[('direction_sharedmail','!=','in')]}"/>
                    <!--<field name="partner_ids" attrs="{'invisible':[('direction_sharedmail','!=','out')]}"/>-->
                    <!--<field name="server_sharedmail_state" attrs="{'invisible':[('direction_sharedmail','!=','out')]}"/>-->
                </tree>
            </field>
        </record>

        <record id="sharedmail_message_search_view" model="ir.ui.view">
            <field name="name">message.search.form</field>
            <field name="model">mail.message</field>
            <field name="priority">26</field>
            <field name="arch" type="xml">
                <search string="Message">
                    <field name="email_from" string="Da"/>
                    <field name="sharedmail_to" string="A"/>
                    <field name="sharedmail_cc" string="CC"/>
                    <field name="subject" string="Oggetto"/>
                    <field name="body" string="Contenuto"/>
                    <field name="date"
                           filter_domain="[('date','&gt;=',self)]"
                           string="Data dal:"/>
                    <field name="date"
                           filter_domain="[('date','&lt;=',self)]"
                           string="Data entro il:"/>
                </search>
            </field>
        </record>

        <!-- mail.message search: wall view !-->
        <record model="ir.ui.view" id="view_message_search_sharedmail">
            <field name="name">mail.message.search.sharedmail</field>
            <field name="model">mail.message</field>
            <field name="priority">10</field>
            <field name="inherit_id" ref="mail.view_message_search"/>
            <field name="arch" type="xml">
                <field name="parent_id" position="after">
                    <field name="sharedmail_cc" string="CC E-mail"/>
                </field>
            </field>
        </record>

        <record model='ir.actions.act_window' id='action_mail_sharedmail'>
            <field name="name">Read Shared E-mail</field>
            <field name="res_model">mail.message</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="sharedmail_message_search_view"/>
            <field name="domain">[('direction_sharedmail', '=', 'in'),('server_sharedmail_id.user_sharedmail_ids','in',uid)]</field>
            <field name="context">{
                'sharedmail_messages': True,
            }</field>
        </record>

        <record model='ir.actions.act_window' id='action_out_mail_sharedmail'>
            <field name="name">Sent Shared E-mail</field>
            <field name="res_model">mail.message</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="sharedmail_message_search_view"/>
            <field name="domain">[
                  ('server_sharedmail_id.sharedmail','=',True),
                  ('direction_sharedmail', '=', 'out'),
                  ('server_sharedmail_id.user_sharedmail_ids','in',uid)]</field>
            <field name="context">{
                'sharedmail_messages': True,
            }</field>
        </record>

        <record model="ir.actions.act_window.view" id="message_sharedmail_act_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="message_sharedmail_tree"/>
            <field name="act_window_id" ref="action_mail_sharedmail"/>
        </record>

        <record model="ir.actions.act_window.view" id="message_sharedmail_act_form">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="message_sharedmail_form"/>
            <field name="act_window_id" ref="action_mail_sharedmail"/>
        </record>

        <record model="ir.actions.act_window.view" id="out_message_sharedmail_act_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="message_sharedmail_tree"/>
            <field name="act_window_id" ref="action_out_mail_sharedmail"/>
        </record>

        <record model="ir.actions.act_window.view" id="out_message_sharedmail_act_form">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="message_sharedmail_form"/>
            <field name="act_window_id" ref="action_out_mail_sharedmail"/>
        </record>

        <record id="mail_sharedmail_main" model="ir.ui.menu">
            <field name="name">Shared E-mail</field>
            <field name="parent_id" ref="mail.mail_feeds_main"/>
            <field name="groups_id" eval="[(4, ref('base.group_sharedmail_reader'))]"/>
        </record>

        <record id="menu_in_mail_sharedmail" model="ir.ui.menu">
            <field name="name">Read Shared E-mail</field>
            <field name="action" ref="action_mail_sharedmail"/>
            <field name="parent_id" ref="mail_sharedmail_main"/>
            <field name="groups_id" eval="[(4, ref('base.group_sharedmail_reader'))]"/>
        </record>

        <record id="menu_out_mail_sharedmail" model="ir.ui.menu">
            <field name="name">Sent Shared E-mail</field>
            <field name="action" ref="action_out_mail_sharedmail"/>
            <field name="parent_id" ref="mail_sharedmail_main"/>
            <field name="groups_id" eval="[(4, ref('base.group_sharedmail_sent'))]"/>
        </record>

        <record id="mail_write_sharedmail" model="ir.ui.menu">
            <field name="name">Write Shared E-mail</field>
            <field name="action" ref="action_sharedmail_mail_compose_message_wizard"/>
            <field name="parent_id" ref="mail_sharedmail_main"/>
            <field name="groups_id" eval="[(4, ref('base.group_sharedmail_writer'))]"/>
        </record>

</data>
</openerp>
